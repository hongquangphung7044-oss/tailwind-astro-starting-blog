---
import { getCollection } from "astro:content";
import SiteMetadata from "@/components/SiteMetadata.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import ListPostCover from "@/components/ListPostCover.astro";
import Link from "@/components/Link.astro";
import { SITE_METADATA, MAX_DISPLAY } from "@/consts";
import { sortBlogPosts, excludeDrafts } from "@/functions";

const posts = await getCollection("blog", excludeDrafts).then(sortBlogPosts);
---

<BaseLayout>
  <SiteMetadata title="Home" />
  <div class="divide-y divide-gray-200 dark:divide-gray-700">
    <div class="space-y-2 pb-8 pt-6 md:space-y-5">
      <h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-6xl md:leading-14">
        最新文章
      </h1>
      <p class="text-lg leading-7 text-gray-500 dark:text-gray-400">
        {SITE_METADATA.description}
      </p>
    </div>
    <ul class="divide-y divide-gray-200 dark:divide-gray-700">
      {!posts.length && '暂无文章。'}
      {
        posts.slice(0, MAX_DISPLAY).map((post) => {
          return (
            <li class="py-12">
              <ListPostCover post={post} />
            </li>
          )
        })
      }
    </ul>
  </div>
  {
    posts.length > MAX_DISPLAY && (
      <div class="flex justify-end text-base font-medium leading-6">
        <Link
          href="/blog"
          class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"
          aria-label="All posts"
        >
          查看全部文章 &rarr;
        </Link>
      </div>
    )
  }
</BaseLayout>
