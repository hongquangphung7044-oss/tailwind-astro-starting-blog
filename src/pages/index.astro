---
import { getCollection } from "astro:content";
import RootLayout from "@/layouts/RootLayout.astro";
import ListPostCover from "@/components/ListPostCover.astro";
import { ITEMS_PER_PAGE } from "@/consts";
import { excludeDrafts, sortBlogPosts } from "@/functions";

// 获取并排序文章
const posts = await getCollection("blog", excludeDrafts).then(sortBlogPosts);
---

<RootLayout title="主页">
  <div class="divide-y divide-gray-200 dark:divide-gray-700">
    <div class="space-y-2 pb-8 pt-6 md:space-y-5">
      <h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-6xl md:leading-14">
        最新文章
      </h1>
      <p class="text-lg leading-7 text-gray-500 dark:text-gray-400">
        记录学习与生活的点滴
      </p>
    </div>
    
    <ul class="divide-y divide-gray-200 dark:divide-gray-700">
      {!posts.length && "暂无文章。"}
      {
        posts.slice(0, ITEMS_PER_PAGE).map((post) => (
          <li class="py-12">
            <ListPostCover {post} />
          </li>
        ))
      }
    </ul>
  </div>

  {
    posts.length > ITEMS_PER_PAGE && (
      <div class="flex justify-end text-base font-medium leading-6">
        <a
          href="/blog"
          class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"
          aria-label="查看所有文章"
        >
          查看更多 &rarr;
        </a>
      </div>
    )
  }
</RootLayout>
